<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members List | BOCOFAMCO Clerk</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
        }
        
        .main-content {
            margin-left: 280px;
            padding: 30px;
            transition: margin-left 0.3s ease;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #1e3a8a;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .search-container {
            position: relative;
            max-width: 400px;
            width: 100%;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 12px 12px 45px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: white;
            font-size: 14px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        
        .archive-btn {
            padding: 12px 24px;
            background-color: #4b5563;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .archive-btn:hover {
            background-color: #374151;
        }
        
        .members-table-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .members-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .members-table th {
            background-color: #f9fafb;
            color: #1e3a8a;
            font-weight: 600;
            text-align: left;
            padding: 15px 20px;
            border-bottom: 2px solid #e5e7eb;
            font-size: 14px;
        }
        
        .members-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
            color: #4b5563;
        }
        
        .members-table tr:last-child td {
            border-bottom: none;
        }
        
        .members-table tr:hover td {
            background-color: #f9fafb;
        }
        
        .cb-number {
            font-weight: 600;
            color: #1e3a8a;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .edit-btn {
            color: #1e3a8a;
        }
        
        .edit-btn:hover {
            background-color: rgba(30, 58, 138, 0.1);
        }
        
        .profile-btn {
            color: #047857;
        }
        
        .profile-btn:hover {
            background-color: rgba(4, 120, 87, 0.1);
        }
        
        .archive-action-btn {
            color: #4b5563;
        }
        
        .archive-action-btn:hover {
            background-color: rgba(75, 85, 99, 0.1);
        }
        
        .pagination {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .pagination-btn {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pagination-btn:hover {
            background-color: #f9fafb;
        }
        
        .pagination-btn.active {
            background-color: #1e3a8a;
            color: white;
            border-color: #1e3a8a;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-text {
            font-size: 14px;
            color: #6b7280;
        }
        
        .table-responsive {
            overflow-x: auto;
        }

        /* Enhanced Toast Notification System */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            min-width: 320px;
            max-width: 400px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: all;
            border-left: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            border-left-color: #10b981;
        }

        .toast.error {
            border-left-color: #ef4444;
        }

        .toast.warning {
            border-left-color: #f59e0b;
        }

        .toast.info {
            border-left-color: #3b82f6;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background-color: #10b981;
        }

        .toast.error .toast-icon {
            background-color: #ef4444;
        }

        .toast.warning .toast-icon {
            background-color: #f59e0b;
        }

        .toast.info .toast-icon {
            background-color: #3b82f6;
        }

        .toast-content {
            flex: 1;
            min-width: 0;
        }

        .toast-title {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            line-height: 1.3;
            margin: 0 0 2px 0;
        }

        .toast-message {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.4;
            margin: 0;
        }

        .toast-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .toast-close:hover {
            color: #6b7280;
            background-color: #f3f4f6;
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            background-color: currentColor;
            opacity: 0.3;
            animation: toastProgress 4s linear forwards;
            transform-origin: left;
        }

        .toast.success .toast-progress {
            color: #10b981;
        }

        .toast.error .toast-progress {
            color: #ef4444;
        }

        .toast.warning .toast-progress {
            color: #f59e0b;
        }

        .toast.info .toast-progress {
            color: #3b82f6;
        }

        @keyframes toastProgress {
            from {
                transform: scaleX(1);
            }
            to {
                transform: scaleX(0);
            }
        }

        /* Profile Modal Styles */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .profile-modal-content {
            background-color: white;
            margin: 20px auto;
            width: 85%;
            max-width: 1025px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .profile-header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            text-align: center;
            position: relative;
        }

        .profile-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid white;
        }

        .profile-header h2 {
            margin: 0;
        }

        .profile-nav-buttons {
            display: flex;
            justify-content: space-around;
            background: #fff;
            padding: 10px 0;
            border-bottom: 2px solid #ddd;
        }

        .profile-nav-buttons button {
            background: none;
            border: none;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
        }

        .profile-nav-buttons button.active {
            border-bottom: 3px solid #2c3e50;
            color: #2c3e50;
        }

        .profile-section {
            padding: 20px;
            display: none;
        }

        .profile-section.active {
            display: block;
        }

        .profile-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 5px;
        }

        .info-value {
            padding: 8px;
            background-color: #f9fafb;
            border-radius: 5px;
            min-height: 38px;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: white;
            cursor: pointer;
        }

        /* Edit Modal Styles */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .edit-modal-content {
            background-color: white;
            margin: 20px auto;
            width: 85%;
            max-width: 1025px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .edit-form {
            padding: 20px;
        }

        .edit-form h3 {
            margin-bottom: 20px;
            color: #1e3a8a;
            text-align: center;
            font-size: 24px;
        }

        .edit-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select {
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .form-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .save-btn,
        .cancel-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .save-btn {
            background-color: #1e3a8a;
            color: white;
        }

        .save-btn:hover {
            background-color: #1c3375;
        }

        .save-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }

        .save-btn.loading {
            pointer-events: none;
        }

        .save-btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .cancel-btn {
            background-color: #dc2626;
            color: white;
        }

        .cancel-btn:hover {
            background-color: #b91c1c;
        }

        /* Archive Modal Styles */
        .archive-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .archive-modal-content {
            background-color: white;
            margin: 20px auto;
            width: 85%;
            max-width: 1025px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .archive-header {
            background-color: #4b5563;
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            text-align: center;
            position: relative;
        }

        .archive-header h2 {
            margin: 0;
        }

        .archive-table-container {
            padding: 20px;
        }

        .archive-table {
            width: 100%;
            border-collapse: collapse;
        }

        .archive-table th {
            background-color: #f9fafb;
            color: #1e3a8a;
            font-weight: 600;
            text-align: left;
            padding: 15px 20px;
            border-bottom: 2px solid #e5e7eb;
            font-size: 14px;
        }

        .archive-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
            color: #4b5563;
        }

        .restore-btn {
            color: #10b981;
        }

        .restore-btn:hover {
            background-color: rgba(16, 185, 129, 0.1);
        }

        /* Confirmation Dialog Styles */
        .confirmation-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            overflow-y: auto;
        }

        .confirmation-content {
            background-color: white;
            margin: 20% auto;
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            padding: 30px;
            text-align: center;
        }

        .confirmation-icon {
            width: 60px;
            height: 60px;
            background-color: #fef2f2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: #4b5563;
            font-size: 24px;
        }

        .confirmation-title {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 10px;
        }

        .confirmation-message {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirmation-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .confirm-btn,
        .cancel-confirm-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .confirm-btn {
            background-color: #4b5563;
            color: white;
        }

        .confirm-btn:hover {
            background-color: #374151;
        }

        .cancel-confirm-btn {
            background-color: #f3f4f6;
            color: #374151;
        }

        .cancel-confirm-btn:hover {
            background-color: #e5e7eb;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header-controls {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }
            
            .search-container {
                max-width: 100%;
            }
            
            .members-table th, 
            .members-table td {
                padding: 12px 15px;
            }

            .archive-table th,
            .archive-table td {
                padding: 12px 15px;
            }

            .profile-modal-content,
            .edit-modal-content,
            .archive-modal-content {
                width: 95%;
                margin: 10px auto;
            }

            .profile-nav-buttons {
                flex-wrap: wrap;
            }

            .profile-nav-buttons button {
                padding: 8px 5px;
                font-size: 12px;
            }

            .profile-info,
            .edit-form-grid {
                grid-template-columns: 1fr;
            }

            .toast-container {
                right: 10px;
                left: 10px;
            }

            .toast {
                min-width: auto;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Confirmation Dialog -->
    <div id="confirmationDialog" class="confirmation-dialog">
        <div class="confirmation-content">
            <div class="confirmation-icon">
                <i class="fas fa-archive"></i>
            </div>
            <h3 class="confirmation-title">Confirm Archive</h3>
            <p class="confirmation-message" id="confirmationMessage"></p>
            <div class="confirmation-actions">
                <button type="button" class="cancel-confirm-btn" onclick="closeConfirmationDialog()">Cancel</button>
                <button type="button" class="confirm-btn" id="confirmArchiveBtn">Archive</button>
            </div>
        </div>
    </div>

    <!-- Archive Modal -->
    <div id="archiveModal" class="archive-modal">
        <div class="archive-modal-content">
            <span class="close-modal" onclick="closeArchiveModal()">&times;</span>
            <div class="archive-header">
                <h2>Archived Members</h2>
            </div>
            <div class="archive-table-container">
                <div class="table-responsive">
                    <table class="archive-table">
                        <thead>
                            <tr>
                                <th>CB Number</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Address</th>
                                <th>Date Archived</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="archiveTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <% const currentPage = 'members'; %>
    <%- include('../partials/clerksidebar', { currentPage }) %>
    
    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title">Members List</h1>
            <div class="header-controls">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search members...">
                </div>
                <button class="archive-btn" onclick="showArchiveModal()">View Archives</button>
            </div>
        </div>
        
        <div class="members-table-container">
            <div class="table-responsive">
                <table class="members-table">
                    <thead>
                        <tr>
                            <th>CB Number</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Address</th>
                            <th>Beneficiaries</th>
                            <th>Emergency Contact</th>
                            <th>Relationship</th>
                            <th>Emergency Address</th>
                            <th>Emergency Number</th>
                            <th>Date Issued</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersTableBody">
                        <% members.filter(member => !member.is_archived).forEach(member => { %>
                            <tr>
                                <td class="cb-number"><%= member.cb_number %></td>
                                <td><%= member.first_name %></td>
                                <td><%= member.last_name %></td>
                                <td><%= member.address %></td>
                                <td><%= member.beneficiaries %></td>
                                <td><%= member.emergency_contact_name || member.emergency_name %></td>
                                <td><%= member.relationship || member.emergency_relationship %></td>
                                <td><%= member.emergency_contact_address || member.emergency_address %></td>
                                <td><%= member.emergency_contact_number || member.emergency_contact %></td>
                                <td><%= member.date_issued ? new Date(member.date_issued).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : '' %></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="action-btn edit-btn" title="Edit Member" 
                                                data-member='<%- JSON.stringify(member).replace(/'/g, "&apos;") %>'
                                                onclick="showEditModal(this)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn profile-btn" title="View Profile" 
                                                data-member='<%- JSON.stringify(member).replace(/'/g, "&apos;") %>'
                                                onclick="showProfileModal(this)">
                                            <i class="fas fa-user"></i>
                                        </button>
                                        <button class="action-btn archive-action-btn" title="Archive Member" 
                                                onclick="showArchiveConfirmation('<%= member.cb_number %>', '<%= member.first_name %> <%= member.last_name %>')">
                                            <i class="fas fa-archive"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="pagination">
            <span class="pagination-text" id="paginationText">Loading...</span>
            <button class="pagination-btn" id="firstPage" disabled><i class="fas fa-angle-double-left"></i></button>
            <button class="pagination-btn" id="prevPage" disabled><i class="fas fa-chevron-left"></i></button>
            <div id="pageNumbers" style="display: inline-flex; gap: 5px;"></div>
            <button class="pagination-btn" id="nextPage"><i class="fas fa-chevron-right"></i></button>
            <button class="pagination-btn" id="lastPage"><i class="fas fa-angle-double-right"></i></button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <span class="close-modal" onclick="closeProfileModal()">&times;</span>
            <div class="profile-header">
                <img id="profilePicture" src="/public/images/default-profile.png" alt="Profile">
                <h2 id="profileName"></h2>
                <p id="profileId"></p>
            </div>

            <div class="profile-nav-buttons">
                <button class="active" onclick="showProfileSection('personal')">Personal</button>
                <button onclick="showProfileSection('family')">Family</button>
                <button onclick="showProfileSection('education')">Education</button>
                <button onclick="showProfileSection('employment')">Employment</button>
                <button onclick="showProfileSection('cooperative')">Cooperative</button>
                <button onclick="showProfileSection('emergency')">Emergency</button>
                <button onclick="showProfileSection('agrarian')">Agrarian</button>
            </div>

            <div class="profile-section active" id="personal-section">
                <h3>Personal Information</h3>
                <div class="profile-info" id="personalInfo"></div>
            </div>

            <div class="profile-section" id="family-section">
                <h3>Family Information</h3>
                <div class="profile-info" id="familyInfo"></div>
            </div>

            <div class="profile-section" id="education-section">
                <h3>Education</h3>
                <div class="profile-info" id="educationInfo"></div>
            </div>

            <div class="profile-section" id="employment-section">
                <h3>Employment and Income</h3>
                <div class="profile-info" id="employmentInfo"></div>
            </div>

            <div class="profile-section" id="cooperative-section">
                <h3>Cooperative Information</h3>
                <div class="profile-info" id="cooperativeInfo"></div>
            </div>

            <div class="profile-section" id="emergency-section">
                <h3>Emergency Contact</h3>
                <div class="profile-info" id="emergencyInfo"></div>
            </div>

            <div class="profile-section" id="agrarian-section">
                <h3>Agrarian Information</h3>
                <div class="profile-info" id="agrarianInfo"></div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="edit-modal">
        <div class="edit-modal-content">
            <span class="close-modal" onclick="closeEditModal()">&times;</span>
            <form id="editMemberForm" class="edit-form">
                <h3>Edit Member Information</h3>
                <div class="edit-form-grid">
                    <div class="form-group">
                        <label for="edit_cb_number">CB Number</label>
                        <input type="text" id="edit_cb_number" name="cb_number" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit_first_name">First Name</label>
                        <input type="text" id="edit_first_name" name="first_name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit_middle_name">Middle Name</label>
                        <input type="text" id="edit_middle_name" name="middle_name">
                    </div>
                    <div class="form-group">
                        <label for="edit_last_name">Last Name</label>
                        <input type="text" id="edit_last_name" name="last_name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit_address">Address</label>
                        <input type="text" id="edit_address" name="address">
                    </div>
                    <div class="form-group">
                        <label for="edit_dob">Date of Birth</label>
                        <input type="date" id="edit_dob" name="dob">
                    </div>
                    <div class="form-group">
                        <label for="edit_gender">Gender</label>
                        <select id="edit_gender" name="gender">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit_contact_number">Contact Number</label>
                        <input type="text" id="edit_contact_number" name="contact_number">
                    </div>
                    <div class="form-group">
                        <label for="edit_email">Email</label>
                        <input type="email" id="edit_email" name="email">
                    </div>
                    <div class="form-group">
                        <label for="edit_emergency_contact_name">Emergency Contact Name</label>
                        <input type="text" id="edit_emergency_contact_name" name="emergency_contact_name">
                    </div>
                    <div class="form-group">
                        <label for="edit_emergency_relationship">Emergency Relationship</label>
                        <input type="text" id="edit_emergency_relationship" name="emergency_relationship">
                    </div>
                    <div class="form-group">
                        <label for="edit_emergency_contact_address">Emergency Contact Address</label>
                        <input type="text" id="edit_emergency_contact_address" name="emergency_contact_address">
                    </div>
                    <div class="form-group">
                        <label for="edit_emergency_contact_number">Emergency Contact Number</label>
                        <input type="text" id="edit_emergency_contact_number" name="emergency_contact_number">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="save-btn" id="saveBtn">
                        <span class="btn-text">Save Changes</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Toast Notification System
        class ToastManager {
            constructor() {
                this.container = document.getElementById('toastContainer');
                this.toasts = [];
            }

            show(message, type = 'success', title = null, duration = 4000) {
                const toast = this.createToast(message, type, title, duration);
                this.container.appendChild(toast);
                this.toasts.push(toast);

                setTimeout(() => {
                    toast.classList.add('show');
                }, 100);

                setTimeout(() => {
                    this.removeToast(toast);
                }, duration);

                return toast;
            }

            createToast(message, type, title, duration) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;

                const icons = {
                    success: '✓',
                    error: '✕',
                    warning: '⚠',
                    info: 'ℹ'
                };

                const titles = {
                    success: title || 'Success',
                    error: title || 'Error',
                    warning: title || 'Warning',
                    info: title || 'Information'
                };

                toast.innerHTML = `
                    <div class="toast-icon">${icons[type]}</div>
                    <div class="toast-content">
                        <div class="toast-title">${titles[type]}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close" onclick="toastManager.removeToast(this.parentElement)">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="toast-progress"></div>
                `;

                return toast;
            }

            removeToast(toast) {
                if (!toast || !toast.parentElement) return;
                
                toast.style.transform = 'translateX(100%)';
                toast.style.opacity = '0';
                
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.parentElement.removeChild(toast);
                    }
                    this.toasts = this.toasts.filter(t => t !== toast);
                }, 300);
            }

            success(message, title = null) {
                return this.show(message, 'success', title);
            }

            error(message, title = null) {
                return this.show(message, 'error', title);
            }

            warning(message, title = null) {
                return this.show(message, 'warning', title);
            }

            info(message, title = null) {
                return this.show(message, 'info', title);
            }
        }

        const toastManager = new ToastManager();

        // Pagination Configuration
        const config = {
            itemsPerPage: 10,
            maxVisiblePages: 5
        };

        // DOM Elements
        const elements = {
            tableBody: document.getElementById('membersTableBody'),
            paginationText: document.getElementById('paginationText'),
            firstPageBtn: document.getElementById('firstPage'),
            prevPageBtn: document.getElementById('prevPage'),
            nextPageBtn: document.getElementById('nextPage'),
            lastPageBtn: document.getElementById('lastPage'),
            pageNumbersContainer: document.getElementById('pageNumbers'),
            searchInput: document.getElementById('searchInput'),
            editModal: document.getElementById('editModal'),
            editForm: document.getElementById('editMemberForm'),
            saveBtn: document.getElementById('saveBtn'),
            confirmationDialog: document.getElementById('confirmationDialog'),
            confirmArchiveBtn: document.getElementById('confirmArchiveBtn'),
            confirmationMessage: document.getElementById('confirmationMessage'),
            archiveModal: document.getElementById('archiveModal'),
            archiveTableBody: document.getElementById('archiveTableBody')
        };

        // State Management
        const state = {
            currentPage: 1,
            totalItems: '<%= members.filter(member => !member.is_archived).length %>',
            filteredItems: '<%= members.filter(member => !member.is_archived).length %>',
            currentArchiveTarget: null,
            get totalPages() {
                return Math.ceil(this.filteredItems / config.itemsPerPage);
            }
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            initializePagination();
            setupEventListeners();
            updateUI();
        });

        // Core Functions
        function initializePagination() {
            renderPageNumbers();
            updateTableDisplay();
        }

        function setupEventListeners() {
            elements.firstPageBtn.addEventListener('click', () => goToPage(1));
            elements.prevPageBtn.addEventListener('click', () => goToPage(state.currentPage - 1));
            elements.nextPageBtn.addEventListener('click', () => goToPage(state.currentPage + 1));
            elements.lastPageBtn.addEventListener('click', () => goToPage(state.totalPages));
            
            elements.searchInput.addEventListener('input', handleSearch);
            
            window.onclick = function(event) {
                if (event.target == document.getElementById('profileModal')) {
                    closeProfileModal();
                }
                if (event.target == document.getElementById('editModal')) {
                    closeEditModal();
                }
                if (event.target == document.getElementById('confirmationDialog')) {
                    closeConfirmationDialog();
                }
                if (event.target == document.getElementById('archiveModal')) {
                    closeArchiveModal();
                }
            };

            elements.editForm.addEventListener('submit', handleEditSubmit);
        }

        function updateUI() {
            updatePaginationText();
            updateNavigationButtons();
        }

        function updateTableDisplay() {
            const rows = elements.tableBody.querySelectorAll('tr');
            const startIndex = (state.currentPage - 1) * config.itemsPerPage;
            const endIndex = Math.min(startIndex + config.itemsPerPage, state.filteredItems);
            
            rows.forEach((row, index) => {
                row.style.display = (index >= startIndex && index < endIndex) ? '' : 'none';
            });
        }

        function updatePaginationText() {
            const startItem = (state.currentPage - 1) * config.itemsPerPage + 1;
            const endItem = Math.min(state.currentPage * config.itemsPerPage, state.filteredItems);
            elements.paginationText.textContent = `Showing ${startItem}-${endItem} of ${state.filteredItems} entries`;
        }

        function updateNavigationButtons() {
            elements.firstPageBtn.disabled = state.currentPage === 1;
            elements.prevPageBtn.disabled = state.currentPage === 1;
            elements.nextPageBtn.disabled = state.currentPage === state.totalPages;
            elements.lastPageBtn.disabled = state.currentPage === state.totalPages;
        }

        function renderPageNumbers() {
            elements.pageNumbersContainer.innerHTML = '';
            
            let startPage = Math.max(1, state.currentPage - Math.floor(config.maxVisiblePages / 2));
            let endPage = Math.min(state.totalPages, startPage + config.maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < config.maxVisiblePages) {
                startPage = Math.max(1, endPage - config.maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                createPageButton(1);
                if (startPage > 2) createEllipsis();
            }
            
            for (let i = startPage; i <= endPage; i++) {
                createPageButton(i);
            }
            
            if (endPage < state.totalPages) {
                if (endPage < state.totalPages - 1) createEllipsis();
                createPageButton(state.totalPages);
            }
        }

        function createPageButton(pageNumber) {
            const button = document.createElement('button');
            button.className = `pagination-btn ${pageNumber === state.currentPage ? 'active' : ''}`;
            button.textContent = pageNumber;
            button.onclick = () => goToPage(pageNumber);
            elements.pageNumbersContainer.appendChild(button);
        }

        function createEllipsis() {
            const ellipsis = document.createElement('span');
            ellipsis.className = 'pagination-text';
            ellipsis.textContent = '...';
            elements.pageNumbersContainer.appendChild(ellipsis);
        }

        function goToPage(pageNumber) {
            if (pageNumber < 1 || pageNumber > state.totalPages) return;
            
            state.currentPage = pageNumber;
            updateTableDisplay();
            updateUI();
            renderPageNumbers();
        }

        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            const rows = elements.tableBody.querySelectorAll('tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const isVisible = text.includes(searchTerm);
                row.style.display = isVisible ? '' : 'none';
                if (isVisible) visibleCount++;
            });
            
            state.filteredItems = visibleCount;
            state.currentPage = 1;
            initializePagination();
        }

        // Member Profile Functions
        function showProfileModal(buttonElement) {
            try {
                const member = JSON.parse(buttonElement.getAttribute('data-member'));
                
                document.getElementById('profileName').textContent = 
                    `${member.first_name} ${member.middle_name ? member.middle_name + ' ' : ''}${member.last_name}`;
                document.getElementById('profileId').textContent = `Member ID: ${member.cb_number}`;
                
                if (member.profile_picture) {
                    document.getElementById('profilePicture').src = member.profile_picture;
                }

                const createInfoItem = (label, value) => {
                    return value ? `
                        <div class="info-item">
                            <span class="info-label">${label}</span>
                            <div class="info-value">${value}</div>
                        </div>
                    ` : '';
                };

                const sections = {
                    personal: [
                        createInfoItem('CB Number', member.cb_number),
                        createInfoItem('Date of Birth', member.dob),
                        createInfoItem('Gender', member.gender),
                        createInfoItem('Civil Status', member.civil_status),
                        createInfoItem('Age', member.age),
                        createInfoItem('Place of Birth', member.place_of_birth),
                        createInfoItem('Nationality', member.nationality),
                        createInfoItem('Religion', member.religion),
                        createInfoItem('Address', member.address),
                        createInfoItem('Contact Number', member.contact_number),
                        createInfoItem('Email', member.email)
                    ],
                    family: [
                        createInfoItem('Spouse Name', member.spouse_name),
                        createInfoItem('Spouse Age', member.spouse_age),
                        createInfoItem('Spouse Occupation', member.spouse_occupation),
                        createInfoItem("Father's Name", member.father_name),
                        createInfoItem("Mother's Name", member.mother_name),
                        createInfoItem("Parent's Address", member.parent_address),
                        createInfoItem('Number of Children', member.number_of_children),
                        createInfoItem('Children Info', member.children_info)
                    ],
                    education: [
                        createInfoItem('Educational Attainment', member.educational_attainment),
                        createInfoItem('Elementary School', member.elementary_school),
                        createInfoItem('Elementary Address', member.elementary_address),
                        createInfoItem('Elementary Year Graduated', member.elementary_year_graduated),
                        createInfoItem('Secondary School', member.secondary_school),
                        createInfoItem('Secondary Address', member.secondary_address),
                        createInfoItem('Secondary Year Graduated', member.secondary_year_graduated),
                        createInfoItem('College School', member.college_school),
                        createInfoItem('College Address', member.college_address),
                        createInfoItem('College Year Graduated', member.college_year_graduated),
                        createInfoItem('Vocational School', member.vocational_school),
                        createInfoItem('Vocational Address', member.vocational_address),
                        createInfoItem('Vocational Year Graduated', member.vocational_year_graduated)
                    ],
                    employment: [
                        createInfoItem('Occupation', member.occupation),
                        createInfoItem('Other Income', member.other_income),
                        createInfoItem('Annual Income', member.annual_income)
                    ],
                    cooperative: [
                        createInfoItem('Membership Date', member.membership_date),
                        createInfoItem('Cooperative Position', member.cooperative_position),
                        createInfoItem('Recruited By', member.recruited_by),
                        member.signature ? createInfoItem('Signature', 'On file') : '',
                        createInfoItem('Signed Date', member.signed_date)
                    ],
                    emergency: [
                        createInfoItem('Emergency Contact Name', member.emergency_contact_name || member.emergency_name),
                        createInfoItem('Emergency Contact Address', member.emergency_contact_address || member.emergency_address),
                        createInfoItem('Relation', member.relationship || member.emergency_relationship),
                        createInfoItem('Emergency Contact Number', member.emergency_contact_number || member.emergency_contact)
                    ],
                    agrarian: [
                        createInfoItem('Agrarian Beneficiary', member.agrarian_beneficiary),
                        createInfoItem('Farm Area', member.farm_area),
                        createInfoItem('Farm Type', member.farm_type),
                        createInfoItem('Is Tenant', member.is_tenant)
                    ]
                };

                Object.keys(sections).forEach(section => {
                    document.getElementById(`${section}Info`).innerHTML = sections[section].join('');
                });

                document.getElementById('profileModal').style.display = 'block';
            } catch (error) {
                console.error('Error showing profile modal:', error);
                toastManager.error('Failed to load member profile. Please try again.');
            }
        }

        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
        }

        function showProfileSection(sectionId) {
            document.querySelectorAll('.profile-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.profile-nav-buttons button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`${sectionId}-section`).classList.add('active');
            event.target.classList.add('active');
        }

        function showEditModal(buttonElement) {
            try {
                const member = JSON.parse(buttonElement.getAttribute('data-member'));
                
                document.getElementById('edit_cb_number').value = member.cb_number || '';
                document.getElementById('edit_first_name').value = member.first_name || '';
                document.getElementById('edit_middle_name').value = member.middle_name || '';
                document.getElementById('edit_last_name').value = member.last_name || '';
                document.getElementById('edit_address').value = member.address || '';
                document.getElementById('edit_dob').value = member.dob || '';
                document.getElementById('edit_gender').value = member.gender || '';
                document.getElementById('edit_contact_number').value = member.contact_number || '';
                document.getElementById('edit_email').value = member.email || '';
                document.getElementById('edit_emergency_contact_name').value = member.emergency_contact_name || member.emergency_name || '';
                document.getElementById('edit_emergency_relationship').value = member.emergency_relationship || member.relationship || '';
                document.getElementById('edit_emergency_contact_address').value = member.emergency_contact_address || member.emergency_address || '';
                document.getElementById('edit_emergency_contact_number').value = member.emergency_contact_number || member.emergency_contact || '';

                elements.editModal.style.display = 'block';
            } catch (error) {
                console.error('Error showing edit modal:', error);
                toastManager.error('Failed to load member edit form. Please try again.');
            }
        }

        function closeEditModal() {
            elements.editModal.style.display = 'none';
            elements.editForm.reset();
            resetSaveButton();
        }

        function setSaveButtonLoading(loading) {
            if (loading) {
                elements.saveBtn.classList.add('loading');
                elements.saveBtn.disabled = true;
                elements.saveBtn.querySelector('.btn-text').textContent = 'Saving...';
            } else {
                elements.saveBtn.classList.remove('loading');
                elements.saveBtn.disabled = false;
                elements.saveBtn.querySelector('.btn-text').textContent = 'Save Changes';
            }
        }

        function resetSaveButton() {
            setSaveButtonLoading(false);
        }

        async function handleEditSubmit(event) {
            event.preventDefault();
            
            setSaveButtonLoading(true);
            
            const formData = new FormData(elements.editForm);
            const memberData = Object.fromEntries(formData);

            try {
                const response = await fetch('/clerk/update-member', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(memberData)
                });

                if (response.status === 401) {
                    toastManager.error('Your session has expired. Please log in again.', 'Session Expired');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return;
                }

                const result = await response.json();
                
                if (result.success) {
                    toastManager.success(`Member ${memberData.cb_number} has been updated successfully!`, 'Update Complete');
                    closeEditModal();
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    toastManager.error(result.message || 'An unexpected error occurred while updating the member.', 'Update Failed');
                }
            } catch (error) {
                console.error('Error updating member:', error);
                toastManager.error('Network error occurred. Please check your connection and try again.', 'Connection Error');
            } finally {
                setSaveButtonLoading(false);
            }
        }

        function showArchiveConfirmation(cbNumber, memberName) {
            state.currentArchiveTarget = cbNumber;
            elements.confirmationMessage.textContent = `Are you sure you want to archive ${memberName} (${cbNumber})?`;
            elements.confirmationDialog.style.display = 'block';
            
            elements.confirmArchiveBtn.onclick = () => confirmArchive(cbNumber);
        }

        function closeConfirmationDialog() {
            elements.confirmationDialog.style.display = 'none';
            state.currentArchiveTarget = null;
        }

        async function confirmArchive(cbNumber) {
            closeConfirmationDialog();
            
            try {
                const response = await fetch(`/clerk/archive-member/${cbNumber}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    toastManager.error('Your session has expired. Please log in again.', 'Session Expired');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return;
                }

                const result = await response.json();
                
                if (result.success) {
                    toastManager.success(`Member ${cbNumber} has been successfully archived.`, 'Member Archived');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    toastManager.error(result.message || 'An unexpected error occurred while archiving the member.', 'Archive Failed');
                }
            } catch (error) {
                console.error('Error archiving member:', error);
                toastManager.error('Network error occurred. Please check your connection and try again.', 'Connection Error');
            }
        }

        async function showArchiveModal() {
            try {
                const response = await fetch('/clerk/archived-members', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    toastManager.error('Your session has expired. Please log in again.', 'Session Expired');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return;
                }

                const result = await response.json();
                
                if (result.success) {
                    elements.archiveTableBody.innerHTML = result.members.map(member => `
                        <tr>
                            <td class="cb-number">${member.cb_number}</td>
                            <td>${member.first_name}</td>
                            <td>${member.last_name}</td>
                            <td>${member.address}</td>
                            <td>${member.archived_at ? new Date(member.archived_at).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : ''}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn restore-btn" title="Restore Member" 
                                            onclick="restoreMember('${member.cb_number}', '${member.first_name} ${member.last_name}')">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                    elements.archiveModal.style.display = 'block';
                } else {
                    toastManager.error(result.message || 'Failed to load archived members.', 'Load Failed');
                }
            } catch (error) {
                console.error('Error loading archived members:', error);
                toastManager.error('Network error occurred. Please check your connection and try again.', 'Connection Error');
            }
        }

        function closeArchiveModal() {
            elements.archiveModal.style.display = 'none';
            elements.archiveTableBody.innerHTML = '';
        }

        async function restoreMember(cbNumber, memberName) {
            try {
                const response = await fetch(`/clerk/restore-member/${cbNumber}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    toastManager.error('Your session has expired. Please log in again.', 'Session Expired');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return;
                }

                const result = await response.json();
                
                if (result.success) {
                    toastManager.success(`Member ${cbNumber} has been successfully restored.`, 'Member Restored');
                    setTimeout(() => {
                        closeArchiveModal();
                        window.location.reload();
                    }, 1500);
                } else {
                    toastManager.error(result.message || 'An unexpected error occurred while restoring the member.', 'Restore Failed');
                }
            } catch (error) {
                console.error('Error restoring member:', error);
                toastManager.error('Network error occurred. Please check your connection and try again.', 'Connection Error');
            }
        }
    </script>
</body>
</html>